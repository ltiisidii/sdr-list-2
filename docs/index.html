<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de SDRs</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <div id="map" style="height: 600px;"></div>

    <div>
        <label>
            <input type="checkbox" id="kiwisdrCheckbox"> Mostrar KiwiSDR
        </label>
        <label>
            <input type="checkbox" id="openwebrxCheckbox"> Mostrar OpenWebRX
        </label>
        <label>
            <input type="checkbox" id="websdrCheckbox"> Mostrar WebSDR
        </label>
    </div>
    <!-- Texto de ayuda -->
    <div>
        <p>Modo de uso: Si necesitas un SDR, selecciona el tipo (Kiwisdr, OpenWebRX o WebSDR). Esto mostrará la ubicación de cada tipo de SDR. Al hacer clic sobre el marcador, se abrirá un popup con la información y el enlace para conectarse.</p>
        <p>Para más información sobre cada tipo de SDR, visita los siguientes enlaces:</p>
        <ul>
            <li>KiwiSDR: <a href="http://kiwisdr.com/" target="_blank">http://kiwisdr.com/</a></li>
            <li>OpenWebRX: <a href="https://fms.komkon.org/OWRX/" target="_blank">https://fms.komkon.org/OWRX/</a></li>
            <li>WebSDR: <a href="http://www.websdr.org/" target="_blank">http://www.websdr.org/</a></li>
        </ul>
    </div>

    <script>
        var map = L.map('map').setView([0, 0], 2); // Inicializar el mapa Leaflet con centro en [0, 0] y nivel de zoom 2

        // Agregar OpenStreetMap como capa base
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Definir los iconos personalizados
        var greenIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/docs/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var blueIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/docs/img/marker-icon-2x-blue.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/docs/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Función para cargar datos JSON y crear marcadores con el icono correspondiente
        function loadJSONMarkers(url, color) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        var marker;
                        switch(color) {
                            case 'green':
                                marker = L.marker([item.lat, item.lon], { icon: greenIcon }).addTo(map);
                                break;
                            case 'blue':
                                marker = L.marker([item.lat, item.lon], { icon: blueIcon }).addTo(map);
                                break;
                            case 'red':
                                marker = L.marker([item.lat, item.lon], { icon: redIcon }).addTo(map);
                                break;
                            default:
                                marker = L.marker([item.lat, item.lon]).addTo(map);
                        }
                        marker.bindPopup(`<b>ID:</b> ${item.id}<br>
                                          <b>Comentario:</b> ${item.comment}<br>
                                          <b>URL:</b> <a href="${item.url}" target="_blank">conectarse al sdr</a><br>
                                          <b>Usuarios Máximos:</b> ${item.maxusers}<br>
                                          <b>Altitud:</b> ${item.altitude}<br>
                                          <b>Antena:</b> ${item.antenna}<br>
                                          <b>Dispositivo:</b> ${item.device}`);
                    });
                });
        }

        // Cargar marcadores JSON desde URL según el estado del checkbox
        document.getElementById('kiwisdrCheckbox').addEventListener('change', function() {
            var url = this.checked ? 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/main/kiwisdr.json' : null;
            if (url) {
                loadJSONMarkers(url, 'green');
            } else {
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker && layer.options.icon.options.iconUrl === greenIcon.options.iconUrl) {
                        map.removeLayer(layer);
                    }
                });
            }
        });

        document.getElementById('openwebrxCheckbox').addEventListener('change', function() {
            var url = this.checked ? 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/main/openwebrx.json' : null;
            if (url) {
                loadJSONMarkers(url, 'blue');
            } else {
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker && layer.options.icon.options.iconUrl === blueIcon.options.iconUrl) {
                        map.removeLayer(layer);
                    }
                });
            }
        });

        document.getElementById('websdrCheckbox').addEventListener('change', function() {
            var url = this.checked ? 'https://raw.githubusercontent.com/ltiisidii/sdr-list-2/main/websdr.json' : null;
            if (url) {
                loadJSONMarkers(url, 'red');
            } else {
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker && layer.options.icon.options.iconUrl === redIcon.options.iconUrl) {
                        map.removeLayer(layer);
                    }
                });
            }
        });

    </script>
</body>
</html>
